---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import SkillBadge from "@/components/ui/SkillBadge.astro";
import { skillsData, type SkillName } from "@/data/skills";
import { Icon } from "astro-icon/components";
import { getProjectTypeInfo, getStatusInfo } from "@/utils/helpers";
import ThemeToggle from "@/components/ThemeToggle.astro";

// Obtener todos los proyectos
export async function getStaticPaths() {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    params: { project: project.slug },
    props: { project },
  }));
}

// Recuperar el proyecto de las props
const { project } = Astro.props;
const { Content } = await project.render();
const imagePath = `/assets/projects/${project.slug}.webp`;

const typeInfo = getProjectTypeInfo(project.data.type || "web");
const statusInfo = getStatusInfo(project.data.status || "completed");
---

<Layout title={project.data.title || "Proyecto"} showHeader={false}>
  <div
    class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-slate-950"
  >
    <!-- Header -->
    <div
      class="sticky flex justify-evenly top-0 z-50 backdrop-blur-xl bg-white/80 dark:bg-gray-950/80 border-b border-gray-200/50 dark:border-gray-800/50"
    >
      <div class="container mx-auto px-4 md:px-6 xl:px-24 py-4">
        <a
          href="/projects"
          class="inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-all duration-200 hover:gap-3"
        >
          <!-- <ArrowLeft className="w-4 h-4" /> -->
          <Icon name="mdi:arrow-left" class="w-4 h-4" />
          Volver a proyectos
        </a>
      </div>
      <div class="pr-4 items-center flex">
        <ThemeToggle />
      </div>
    </div>

    <!-- Hero Section -->
    <div class="container mx-auto px-4 md:px-6 xl:px-24 py-12 lg:py-20">
      <div class="grid lg:grid-cols-12 gap-8 lg:gap-12 items-start">
        <!-- Project Image -->
        <div class="lg:col-span-7">
          <div class="relative group">
            <!-- Image container with modern styling -->
            <div
              class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 aspect-auto shadow-2xl shadow-gray-200/50 dark:shadow-gray-900/50"
            >
              <!-- Loading placeholder -->
              <div
                class="absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 animate-pulse"
                id="loading-placeholder"
              >
              </div>

              <!-- Actual image -->
              <img
                src={imagePath}
                alt={project.data.title || "Imagen del proyecto"}
                class="w-full h-full transition-transform duration-700 group-hover:scale-105"
                onload="document.getElementById('loading-placeholder').style.display = 'none'"
                transition:name={`${project.slug}-image`}
              />

              <!-- Overlay gradient -->
              <div
                class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
            </div>
          </div>
        </div>

        <!-- Project Info -->
        <div class="lg:col-span-5 space-y-5">
          <!-- Header Info -->
          <div class="space-y-4">
            <!-- Type and Status badges -->
            <div class="flex flex-wrap gap-3">
              <span
                class={`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium bg-${typeInfo.color}-50 text-${typeInfo.color}-700 dark:bg-${typeInfo.color}-950/30 dark:text-${typeInfo.color}-300 border border-${typeInfo.color}-200/50 dark:border-${typeInfo.color}-800/50`}
              >
                <Icon name={typeInfo.icon} class="w-3.5 h-3.5" />
                {typeInfo.label}
              </span>
              <span
                class={`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium ${statusInfo.bg} text-${statusInfo.color}-700 dark:text-${statusInfo.color}-300 border border-${statusInfo.color}-200/50 dark:border-${statusInfo.color}-800/50`}
              >
                <div
                  class={`w-2 h-2 rounded-full bg-${statusInfo.color}-500 ${project.data.status === "in-progress" ? "animate-pulse" : ""}`}
                >
                </div>
                {statusInfo.label}
              </span>
            </div>

            <!-- Title -->
            <h1
              class="text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent leading-tight"
            >
              {project.data.title}
            </h1>

            <!-- Short description -->
            {
              project.data.shortDescription && (
                <p class="text-lg text-gray-600 dark:text-gray-400 leading-relaxed">
                  {project.data.shortDescription}
                </p>
              )
            }
          </div>

          
            <!-- Action Buttons - Positioned right after title -->
            {(project.data.url || project.data.demo || project.data.repository || project.data.playstore_url) && (
              <div class="space-y-3">
                <!-- Primary action buttons -->
                <div class="flex flex-wrap gap-3">
                  {
                    project.data.url && (
                      <a
                        href={project.data.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-300 text-sm"
                      >
                        {project.data.type === "web" ? (
                          <>
                            <Icon name="mdi:web" class="w-4 h-4" />
                            Visitar sitio
                          </>
                        ) : (
                          <>
                            <Icon name="mdi:open-in-new" class="w-4 h-4" />
                            Ver proyecto
                          </>
                        )}
                      </a>
                    )
                  }

                   {
                    project.data.playstore_url && (
                      <a
                        href={project.data.playstore_url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-300 text-sm"
                      >
                        <Icon name="logos:google-play-icon" class="w-4 h-4" />
                        Ver en Play Store
                      </a>
                    )
                  }

                  {
                    project.data.demo && (
                      <a
                        href={project.data.demo}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-300 text-sm"
                      >
                        <Icon name="mdi:play" class="w-4 h-4" />
                        Ver Demo
                      </a>
                    )
                  }

                  {
                    project.data.repository && (
                      <a
                        href={project.data.repository}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-gray-400 dark:hover:border-gray-600 hover:shadow-md transition-all duration-200 text-sm"
                      >
                        <Icon name="mdi:github" class="w-4 h-4" />
                        Repositorio
                      </a>
                    )
                  }
                </div>
              </div>
            )}

          <!-- Technologies -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
              Tecnologías Utilizadas
            </h3>
            <div class="flex flex-wrap gap-2">
              {
                project.data.skills.map((skill: SkillName) => (
                  <SkillBadge skill={skill} size="sm" />
                ))
              }
            </div>
          </div>

          <!-- Quick Description -->
          {
            project.data.description && (
              <div class="space-y-3">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                  Descripción
                </h3>
                <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
                  {project.data.description}
                </p>
              </div>
            )
          }
        </div>
      </div>
    </div>

    <!-- Detailed Content -->
    <div class="container mx-auto px-4 md:px-6 xl:px-24 pb-20">
      <div class="max-w-4xl mx-auto">
        <!-- Content separator -->
        <div
          class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mx-auto mb-12"
        >
        </div>

        <!-- Markdown content with enhanced styling -->
        <div
          class="prose prose-lg dark:prose-invert prose-slate max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-h1:text-3xl prose-h2:text-2xl prose-h2:border-b prose-h2:border-gray-200 prose-h2:dark:border-gray-700 prose-h2:pb-2 prose-p:text-gray-600 prose-p:dark:text-gray-400 prose-p:leading-relaxed prose-code:bg-gray-100 prose-code:dark:bg-gray-800 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-pre:bg-gray-900 prose-pre:border prose-pre:border-gray-700 prose-ul:space-y-1 prose-li:text-gray-600 prose-li:dark:text-gray-400"
        >
          <Content />
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
  }

  ::-webkit-scrollbar-track {
    background-color: rgb(243 244 246);
  }

  ::-webkit-scrollbar-thumb {
    background-color: rgb(156 163 175);
    border-radius: 9999px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(107 114 128);
  }

  /* Dark mode scrollbar */
  @media (prefers-color-scheme: dark) {
    ::-webkit-scrollbar-track {
      background-color: rgb(17 24 39);
    }

    ::-webkit-scrollbar-thumb {
      background-color: rgb(75 85 99);
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: rgb(107 114 128);
    }
  }

  /* Enhanced prose styles */
  .prose blockquote {
    border-left: 4px solid rgb(59 130 246);
    background-color: rgb(239 246 255);
    padding: 1rem;
    border-radius: 0 0.5rem 0.5rem 0;
    margin: 1.5rem 0;
  }

  @media (prefers-color-scheme: dark) {
    .prose blockquote {
      background-color: rgb(30 58 138 / 0.3);
    }
  }

  .prose table {
    background-color: white;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    border: 1px solid rgb(229 231 235);
  }

  @media (prefers-color-scheme: dark) {
    .prose table {
      background-color: rgb(17 24 39);
      border-color: rgb(55 65 81);
    }
  }

  .prose th {
    background-color: rgb(249 250 251);
    font-weight: 600;
  }

  @media (prefers-color-scheme: dark) {
    .prose th {
      background-color: rgb(31 41 55);
    }
  }

  .prose td,
  .prose th {
    border-color: rgb(229 231 235);
  }

  @media (prefers-color-scheme: dark) {
    .prose td,
    .prose th {
      border-color: rgb(55 65 81);
    }
  }
</style>
